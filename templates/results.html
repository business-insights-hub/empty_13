{% extends "base.html" %}

{% block content %}
<div class="results-page">
    <div class="query-section">
        <h2>ğŸ“ Sizin SualÄ±nÄ±z:</h2>
        <div class="query-box">{{ query }}</div>
        <a href="/" class="btn-secondary">â† Yeni axtarÄ±ÅŸ</a>
    </div>

    <div class="answer-section">
        <h2>ğŸ’¡ Cavab:</h2>
        <div class="answer-box">
            {% set parts = answer.split('ğŸ“š **MÉ™nbÉ™lÉ™r:**') %}
            <div class="answer-content">
                {{ parts[0] | trim }}
            </div>
            {% if parts|length > 1 %}
            <div class="answer-sources">
                <strong>ğŸ“š MÉ™nbÉ™lÉ™r:</strong>
                <div class="sources-list">
                    {% for source in parts[1].split('|') %}
                        <div class="source-item">{{ source | trim }}</div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    {% if vector_results %}
    <div class="vector-results">
        <h2>ğŸ“Š Vektor AxtarÄ±ÅŸÄ± NÉ™ticÉ™lÉ™ri:</h2>
        {% for result in vector_results %}
        <div class="result-card">
            <div class="result-header">
                <span class="result-score">OxÅŸarlÄ±q: {{ "%.2f"|format(result.score * 100) }}%</span>
                <span class="result-source">{{ result.metadata.get('original_filename', result.metadata.get('doc_id', 'SÉ™nÉ™d')) }}</span>
            </div>
            <div class="result-text">
                {{ result.metadata.get('text', 'MÉ™tn mÃ¶vcud deyil')[:500] }}
                {% if result.metadata.get('text', '')|length > 500 %}...{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if graph_results %}
    <div class="graph-results">
        <h2>ğŸ”— Qrafik NÉ™ticÉ™lÉ™ri:</h2>
        {% for result in graph_results %}
        <div class="graph-card">
            <div class="entity-name">{{ result.entity }}</div>
            <div class="entity-types">
                {% for type in result.types %}
                <span class="entity-badge">{{ type }}</span>
                {% endfor %}
            </div>
            {% if result.related_entities %}
            <div class="related-entities">
                <strong>ÆlaqÉ™li:</strong>
                {% for rel in result.related_entities %}
                    {% if rel %}
                        <span class="related-tag">{{ rel }}</span>
                    {% endif %}
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="stats-mini">
        <p>ğŸ“Š Sistem Statusu: {{ stats.neo4j_nodes }} mÉ™lumat | {{ stats.pinecone_vectors }} vektor</p>
    </div>
</div>
{% endblock %}
